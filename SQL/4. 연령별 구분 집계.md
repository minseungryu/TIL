## 성별/연령 구분 집계

### 1. 사용자 나이 구하기

> 나이는 생일과 특정 날짜를 정수로 표현하고, 이 차이를 10,000으로 나누는 방법으로 간단히 구할 수 있다.

1. 먼저 특정 날짜를 정수로 표현한다(기준 날짜)
2. 사용자 생년월일(문자형)을 다음과 같이 정수 표현으로 반환한다.
3. 기준 날짜와 사용자 생년월일(정수형 변환 값)의 차이를 10000으로 나누고 내림하여 나이를 계산한다.

```postgresql
WITH 
mst_users_with_int_birth_date AS (
	SELECT *
		, 20170101 AS int_specific_date
		,CAST(replace(substring(birth_date, 1, 10), '-', '') AS integer) AS int_birth_date
	FROM mst_users
)
, mst_users_with_age AS (
	SELECT *
		, floor((int_specific_date - int_birth_date)/10000) AS age
	FROM mst_users_with_int_birth_date
)
SELECT 
	user_id, sex, birth_date, age
FROM mst_users_with_age
;
```

<br>

### 2. 성별 & 연령으로 구분하여 집계
