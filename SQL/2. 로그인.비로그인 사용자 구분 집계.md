## ë¡œê·¸ì¸/ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ì êµ¬ë¶„ ì§‘ê³„

- user_idê°€ NULLì´ë©´ '' ì„ ë°˜í™˜, ê°’ì´ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ user_idë¥¼ ë°˜í™˜

- user_idê°€ ë°˜í™˜ë˜ë©´, ì¦‰, ë¹ˆê°’ì´ ì•„ë‹ˆë©´ loginì„ ë°˜í™˜í•˜ê³  ë¹ˆ ê°’ì´ë©´ guest ë°˜í™˜

```postgresql
WITH 
ACTION_log_with_status AS (
	SELECT session
		, user_id
		, ACTION
		-- user_idê°€ nullì´ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ íŒì •
		, CASE WHEN COALESCE(user_id, '') <> '' THEN 'login' ELSE 'guset' END AS login_status
	FROM action_log
)
SELECT *
FROM ACTION_log_with_status
;
```



- login_statusë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•¡ì…˜ìˆ˜ì™€ UUë¥¼ ì§‘ê³„
- ì¶”ê°€ë¡œ ë¡œê·¸ì¸/ë¹„ë¡œê·¸ì¸ì„ ë”°ì§€ì§€ ì•Šê³  ì „ì²´(all)ë„ í•¨ê»˜ ì§‘ê³„ ğŸ‘‰ **ROLLUP** êµ¬ë¬¸ ì‚¬ìš©

```postgresql
WITH 
ACTION_log_with_status AS (
	SELECT SESSION
		, user_id
		, ACTION
		-- user_idê°€ nullì´ë©´ ë¡œê·¸ì¸ìœ¼ë¡œ íŒì •
		, CASE WHEN COALESCE(user_id, '') != '' THEN 'login' ELSE 'guset' END AS login_status
	FROM action_log
)
SELECT 
	coalesce(ACTION, 'all') AS "action"
	,coalesce(login_status, 'all') AS login_status
	,count(DISTINCT session) AS action_uu
	,count(1) AS action_count
FROM ACTION_log_with_status
GROUP BY ROLLUP(action, login_status)
;
```

